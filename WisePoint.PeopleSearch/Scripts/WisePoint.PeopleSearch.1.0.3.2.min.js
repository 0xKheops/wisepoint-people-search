"use strict";window.WisePoint=window.WisePoint||{};WisePoint.Utils=WisePoint.Utils||{};WisePoint.PeopleSearch=WisePoint.PeopleSearch||{};WisePoint.PeopleSearch.Resources=WisePoint.PeopleSearch.Resources||{};WisePoint.PeopleSearch.Models=WisePoint.PeopleSearch.Models||{};WisePoint.PeopleSearch.ViewModels=WisePoint.PeopleSearch.ViewModels||{};WisePoint.Utils.GetQueryString=function(){var n=window.location.toString(),t=n.indexOf("?");return n!=-1?decodeURIComponent(n.substring(t)):""};WisePoint.Utils.GetQueryStringParameter=function(n){for(var i,r=document.URL.split("?")[1].split("&"),t=0;t<r.length;t=t+1)if(i=r[t].split("="),i[0]==n)return decodeURIComponent(i[1]);return""};WisePoint.Utils.GetReworkedAppWebUrl=function(n){return n=n.substring(n.indexOf("//")+2),n.substring(n.indexOf("/"))};WisePoint.Utils.DisplayErrorMessage=function(n){alert(n)};WisePoint.Utils.Log=function(n){typeof console!="undefined"&&console.log(n)};WisePoint.Utils.GetSearchResultField=function(n,t){return Enumerable.From(n.Cells.results).Where(function(n){return n.Key===t}).Select(function(n){return n.Value}).FirstOrDefault()};WisePoint.Utils.InitializeTiles=function(){jQuery(".wp-main-container").on("mouseenter",".sptiles-inner",function(){jQuery(this).find(".sptiles-details").stop().animate({top:"0"},400)}).on("mouseleave",".sptiles-inner",function(){jQuery(this).find(".sptiles-details").stop().animate({top:"100px"},400)})};WisePoint.Utils.SetMainContainerMaxWidth=function(n){function t(){var t=$(window).innerWidth()-($("#sideNavBox").css("display")=="block"?$("#sideNavBox").width():0)-100;$(n).css("maxWidth",t+"px")}t();$(window,"#fullscreenmode","#exitfullscreenmode").resize(function(){t()})};window.WisePoint=window.WisePoint||{};WisePoint.Utils=WisePoint.Utils||{};WisePoint.PeopleSearch=WisePoint.PeopleSearch||{};WisePoint.PeopleSearch.Resources=WisePoint.PeopleSearch.Resources||{};WisePoint.PeopleSearch.Models=WisePoint.PeopleSearch.Models||{};WisePoint.PeopleSearch.ViewModels=WisePoint.PeopleSearch.ViewModels||{};WisePoint.PeopleSearch.Resources.EN={DefaultMainPageTitle:"Search People",AppSettings:"Settings",SearchBoxPlaceholder:"Search...",SearchBoxButtonTitle:"Search",RefinerJobTitle:"Job Title",RefinerPeopleKeywords:"Keywords",RefinerOfficeLocation:"Location",RefinerDepartment:"Department",NoResult:"This query returned no results.",NoRefiners:"We don't have any refiners to show you",ResultsCount:"There are {0} people matching your search :",ResultsCount1:"There is 1 people matching your search :",ShowMoreRefiners:"Show more",ShowLessRefiners:"Show less",ResetRefiner:"All",Loading:"Loading...",ViewProfile:"Browse the profile",SettingsSectionLabels:"Customize labels",SettingsSectionLabelsDescription:"You may customize the site title and the page titles that appear in the add-in's main page.",SettingsSectionLabelsAppTitle:"Add-in title :",SettingsSectionLabelsAppTitleValidationError:"This add-in title is invalid.",SettingsSectionLabelsPageTitle:"Page title :",ErrorLoadingProperties:"Failed to load properties. Please contact the owner of this add-in.",ErrorUpdatingProperties:"Failed to update properties. Please contact the owner of this add-in.",SettingsSectionSortResults:"Sort Results",SettingsSectionSortResultsDescription:'<p>This add-in has been designed to sort search results on FirstName and LastName fields (managed properties). <br />However, by default on a SharePoint environment <a href="http://technet.microsoft.com/en-us/library/jj219630.aspx">these managed properties aren\'t sortable<\/a>, this is why sorting in this add-in is turned off by default.<\/p><p>Please ask your local farm administrator to set these 2 managed properties as sortable, wait for a full crawl to occur, then turn this setting on.<\/p><p><span style="font-weight: bold">Warning : <\/span>if you check the checkbox without the 2 managed properties being sortable, all search queries will fail, and no results will be shown.<\/p>',SettingsSectionSortResultsCheckboxLabel:"Sort Results",SettingsSectionSearchQuery:"Search Query",SettingsSectionSearchQueryDescription:'<p>Indicate how many results are retrieved by each search query.<\/p><p>Indicate wether a wildcard should be appended to each search query. For example, if this setting is active, a search with keyword "ob" will be automatically replaced by "ob*" which will match both "Obama" and "Obiwan".<\/p><p>You may also define a query that will be appended to each search queries. For example, you may use "+BaseOfficeLocation:Paris" if you want to force results to be only people working in Paris.<\/p><p>Use the refiners setting to define which refiners are available, and their label.<br />Format : RefinerName1,RefinerLabel1;RefinerName2;RefinerLabel2<\/p><p>By default, the add-in uses the People result source, but you can change this by typing it\'s ID.<br />Default value : B09A7990-05EA-4AF9-81EF-EDFAB16C4E31<\/p>',SettingsSectionSearchQueryResultsPerQueryHeader:"Results per query : ",SettingsSectionSearchQueryResultsPerQueryTitle:"Results per query",SettingsSectionSearchQueryResultsPerQueryValidationError:"Value must be between 5 and 100",SettingsSectionSearchQueryAppendWildcardHeader:"Append wildcard :",SettingsSectionSearchQueryAppendWildcardTitle:"Append wildcard",SettingsSectionSearchQueryHiddenConstraintHeader:"Appended query :",SettingsSectionSearchQueryHiddenConstraintTitle:"Appended search query",SettingsSectionPhotos:"High definition photos",SettingsSectionPhotosDescription:"<p>For increased image quality in search results, turn on the high definition photos setting.<br />The search results photos will then be downloaded in large size.<br />Please note that this setting will affect rendering performance as images will load more slowly, depending on availble bandwidth.<\/p>",SettingsSectionPhotosHighDefPhotosHeader:"High definition photos : ",SettingsSectionPhotosHighDefPhotosTitle:"Display high definition photos",SettingsSectionSearchQueryRefinersHeader:"Refiners : ",SettingsSectionSearchQueryRefinersTitle:"Refiners",SettingsSectionSearchQueryRefinersDefaultValue:"Department,Department;JobTitle,Job Title;PeopleKeywords,Keywords;BaseOfficeLocation,Location",SettingsSectionSearchQueryResultSourceHeader:"Result source :",SettingsSectionSearchQueryResultSourceTitle:"Result source",SettingsButtonOk:"OK",SettingsButtonCancel:"Cancel",StatusBarError:"Error : "};WisePoint.PeopleSearch.Resources.FR={DefaultMainPageTitle:"Recherche de personnes",AppSettings:"Paramètres",SearchBoxPlaceholder:"Rechercher...",SearchBoxButtonTitle:"Rechercher",RefinerJobTitle:"Fonction",RefinerPeopleKeywords:"Mots clés",RefinerOfficeLocation:"Localisation",RefinerDepartment:"Service",NoResult:"Personne ne correspond à votre recherche.",NoRefiners:"Désolé... Nous n’avons aucun affinement à vous proposer",ResultsCount:"Il y a {0} personnes qui correspondent à votre recherche :",ResultsCount1:"Il y a une personne qui correspond à votre recherche :",ShowMoreRefiners:"Afficher plus",ShowLessRefiners:"Afficher moins",ResetRefiner:"Tout",Loading:"Chargement...",ViewProfile:"Voir le profil",SettingsSectionLabels:"Personnalisation des libellés",SettingsSectionLabelsDescription:"Vous pouvez ici personnaliser le nom de l'add-in ainsi que le titre de la page principale.",SettingsSectionLabelsAppTitle:"Nom de l'add-in :",SettingsSectionLabelsAppTitleValidationError:"Ce nom est invalide.",SettingsSectionLabelsPageTitle:"Titre de la page principale :",ErrorLoadingProperties:"Une erreur est survenue pendant le chargement des paramètres. Vous n'avez peut-être pas les permissions nécessaires. Veuillez contacter le propriétaire de cet add-in.",ErrorUpdatingProperties:"Une erreur est survenue pendant l'enregistrement des paramètres. Vous n'avez peut-être pas les permissions nécessaires. Veuillez contacter le propriétaire de cet add-in.",SettingsSectionSortResults:"Tri des résultats",SettingsSectionSortResultsDescription:'<p>Cet add-in est conçue pour trier les résultats avec les propriétés gérées FirstName et LastName.<br />Cependant, par défaut sur un environnement SharePoint, <a href="http://technet.microsoft.com/fr-fr/library/jj219630.aspx">ces propriétés gérées ne sont pas triables<\/a>, c\'est pourquoi ce paramètre est ici désactivé par défaut.<\/p><p>Veuillez demander à l\'administrateur de votre environnement SharePoint de définir ces 2 propriétés gérées comme triables, attendez qu\'une indexation complète soit effectuée, et activez ce paramètre.<\/p><p><span style="font-weight: bold">Attention : <\/span>si vous activez ce paramètre avant que ces 2 propriétés soient triables, toutes les requêtes de recherche échoueront et plus aucun résultat ne sera affiché.<\/p>',SettingsSectionSortResultsCheckboxLabel:"Trier les résultats",SettingsSectionSearchQuery:"Requêtes de recherche",SettingsSectionSearchQueryDescription:'<p>Indiquez combien de résultats doivent être récupérés par chaque requête de recherche.<\/p><p>Indiquez si un wildcard doit être ajouté à chaque requête de recherche. Par exemple, si ce paramètre est activé, une requête portant sur le mot clé "ob*" retournera toutes les personnes dont le nom comporte "Obama" et "Obiwan".<\/p><p>Vous pouvez aussi définir une portion de requête qui sera ajoutée à chaque recherche. Par exemple, vous pouvez utiliser "+BaseOfficeLocation:Paris" si vous souhaitez n\'afficher que des personnes basées à Paris.<\/p><p>Utilisez le paramètre Affinements pour choisir les affinements proposés sur la gauche de l\'écran, ainsi que leurs libellés respectifs. <br />Format : RefinerName1,RefinerLabel1;RefinerName2;RefinerLabel2<\/p><p>Par défaut, l\'add-in utilise l\'origine de résultats People. Vous pouvez choisir une autre origine de résultat en spécifiant son identifiant. <br />Identifiant par défaut : B09A7990-05EA-4AF9-81EF-EDFAB16C4E31<\/p>',SettingsSectionSearchQueryResultsPerQueryHeader:"Nombre de résultats par requête : ",SettingsSectionSearchQueryResultsPerQueryTitle:"Nombre de résultats par requête",SettingsSectionSearchQueryResultsPerQueryValidationError:"La valeur doit être comprise entre 5 et 100",SettingsSectionSearchQueryAppendWildcardHeader:"Ajouter le wildcard :",SettingsSectionSearchQueryAppendWildcardTitle:"Ajouter le wildcard",SettingsSectionSearchQueryHiddenConstraintHeader:"Requête complémentaire :",SettingsSectionSearchQueryHiddenConstraintTitle:"Requête complémentaire",SettingsSectionPhotos:"Photos haute résolution",SettingsSectionPhotosDescription:"<p>Pour améliorer la qualité des photos, activez ce paramètre.<br />Les photos seront alors affichées en taille réelle.<br />Veuillez noter que ce paramètre affecte les performances d'affichage puisque les images plus volumineuses seront chargées plus lentement, en fonction de la bande passante disponible.<\/p>",SettingsSectionPhotosHighDefPhotosHeader:"Photos haute définition : ",SettingsSectionPhotosHighDefPhotosTitle:"Afficher les photos en haute résolution",SettingsSectionSearchQueryRefinersHeader:"Affinements : ",SettingsSectionSearchQueryRefinersTitle:"Affinements",SettingsSectionSearchQueryRefinersDefaultValue:"Department,Service;JobTitle,Fonction;PeopleKeywords,Mots clés;BaseOfficeLocation,Localisation",SettingsSectionSearchQueryResultSourceHeader:"Origine de résultats :",SettingsSectionSearchQueryResultSourceTitle:"Origine de résultats",SettingsButtonOk:"OK",SettingsButtonCancel:"Annuler",StatusBarError:"Erreur : "};WisePoint.PeopleSearch.Resources.Current=WisePoint.Utils.GetQueryStringParameter("SPLanguage").startsWith("fr-")?WisePoint.PeopleSearch.Resources.FR:WisePoint.PeopleSearch.Resources.EN;window.WisePoint=window.WisePoint||{};WisePoint.Utils=WisePoint.Utils||{};WisePoint.PeopleSearch=WisePoint.PeopleSearch||{};WisePoint.PeopleSearch.Resources=WisePoint.PeopleSearch.Resources||{};WisePoint.PeopleSearch.Models=WisePoint.PeopleSearch.Models||{};WisePoint.PeopleSearch.ViewModels=WisePoint.PeopleSearch.ViewModels||{};WisePoint.PeopleSearch.Models.ActiveRefiner=function(n,t,i,r){var u=this;this.GroupName=t;this.Value=i;this.Token=r};window.WisePoint=window.WisePoint||{};WisePoint.Utils=WisePoint.Utils||{};WisePoint.PeopleSearch=WisePoint.PeopleSearch||{};WisePoint.PeopleSearch.Resources=WisePoint.PeopleSearch.Resources||{};WisePoint.PeopleSearch.Models=WisePoint.PeopleSearch.Models||{};WisePoint.PeopleSearch.ViewModels=WisePoint.PeopleSearch.ViewModels||{};WisePoint.PeopleSearch.Models.RefinerEntry=function(n,t,i,r,u,f,e){var o=this;this.GroupName=t;this.Name=i;this.Token=r;this.Count=u;this.Value=f;this.Active=e;this.Label=i+" ("+u+")";this.SetActive=function(){o.Active=!0;n.ActiveRefiners.push(new WisePoint.PeopleSearch.Models.ActiveRefiner(n,o.GroupName,o.Value,o.Token));n.Search(!0,!1)}};window.WisePoint=window.WisePoint||{};WisePoint.Utils=WisePoint.Utils||{};WisePoint.PeopleSearch=WisePoint.PeopleSearch||{};WisePoint.PeopleSearch.Resources=WisePoint.PeopleSearch.Resources||{};WisePoint.PeopleSearch.Models=WisePoint.PeopleSearch.Models||{};WisePoint.PeopleSearch.ViewModels=WisePoint.PeopleSearch.ViewModels||{};WisePoint.PeopleSearch.Models.RefinerGroup=function(n,t,i){var r=this;this.Name=t;this.DisplayName=ko.pureComputed(function(){var t=Enumerable.From(n.RefinerDefinitions()).Where(function(n){return n.Name==r.Name}).SingleOrDefault();return t==null?r.Name:t.Label});this.Entries=i;this.ShowAll=ko.observable(!1);this.Expanded=ko.observable(!0);this.ShowMoreOrLess=ko.pureComputed(function(){return typeof r.Entries!="undefined"&&r.Entries.length>5&&r.Expanded()});this.ShowMore=ko.pureComputed(function(){return r.ShowMoreOrLess()&&!r.ShowAll()});this.ShowLess=ko.pureComputed(function(){return r.ShowMoreOrLess()&&r.ShowAll()});this.ShowMoreClick=function(){r.ShowAll(!0)};this.ShowLessClick=function(){r.ShowAll(!1)};this.ToggleVisibility=function(){r.Expanded(!r.Expanded())};this.IsActive=ko.pureComputed(function(){return Enumerable.From(r.Entries).Any(function(n){return n.Active})},r);this.IsInactive=ko.pureComputed(function(){return!Enumerable.From(r.Entries).Any(function(n){return n.Active})},r);this.SelectedEntry=ko.pureComputed(function(){return Enumerable.From(r.Entries).FirstOrDefault(function(n){return n.Active})},r);this.UnselectedEntries=ko.pureComputed(function(){return Enumerable.From(r.Entries).Where(function(n){return!n.Active}).ToArray()},r);this.DisplayedEntries=ko.pureComputed(function(){return typeof r.Entries=="undefined"||r.ShowAll()||r.Entries.length<=5?r.Entries:Enumerable.From(r.Entries).Take(5).ToArray()});this.Clear=function(){n.ActiveRefiners.remove(function(n){return n.GroupName===r.Name});n.Search(!0,!1)};this.ShowReset=ko.pureComputed(function(){return r.IsActive()&&r.Expanded()});this.ShowSelection=ko.pureComputed(function(){return r.IsActive()});this.ShowRefiners=ko.pureComputed(function(){return r.IsInactive()&&r.Expanded()});this.ArrowClass=ko.pureComputed(function(){return r.Expanded()?"ms-ref-uparrow":"ms-ref-downarrow"})};window.WisePoint=window.WisePoint||{};WisePoint.Utils=WisePoint.Utils||{};WisePoint.PeopleSearch=WisePoint.PeopleSearch||{};WisePoint.PeopleSearch.Resources=WisePoint.PeopleSearch.Resources||{};WisePoint.PeopleSearch.Models=WisePoint.PeopleSearch.Models||{};WisePoint.PeopleSearch.ViewModels=WisePoint.PeopleSearch.ViewModels||{};WisePoint.PeopleSearch.Models.SearchResult=function(n,t,i,r,u,f,e,o){this.lastName=n;this.firstName=t;this.preferredName=i;this.title=r;this.path=u;this.email=f;this.department=e;this.picture=o;this.displayName=null;try{this.displayName=n?n.toUpperCase()+" "+t:i}catch(s){this.displayName=i}};window.WisePoint=window.WisePoint||{};WisePoint.Utils=WisePoint.Utils||{};WisePoint.PeopleSearch=WisePoint.PeopleSearch||{};WisePoint.PeopleSearch.Resources=WisePoint.PeopleSearch.Resources||{};WisePoint.PeopleSearch.Models=WisePoint.PeopleSearch.Models||{};WisePoint.PeopleSearch.ViewModels=WisePoint.PeopleSearch.ViewModels||{};WisePoint.PeopleSearch.ViewModels.MainPage=function(n){var t=this;this.ScrollableArea=$(n);this.PageTitle=ko.observable("");this.SortResults=!1;this.HighDefinitionPhotos=!0;this.ResultsPerQuery=50;this.AppendWildcard=!1;this.AppendedQuery="-AccountName:_spo* -AccountName:app@sharepoint -AccountName:#ext#";this.Refiners=ko.observable(WisePoint.PeopleSearch.Resources.Current.SettingsSectionSearchQueryRefinersDefaultValue);this.ResultSourceId=ko.observable("B09A7990-05EA-4AF9-81EF-EDFAB16C4E31");this.AppWebUrl=WisePoint.Utils.GetQueryStringParameter("SPAppWebUrl");this.HostWebUrl=WisePoint.Utils.GetQueryStringParameter("SPHostUrl");this.SettingsPageUrl="Settings.aspx"+WisePoint.Utils.GetQueryString();this.Initialized=ko.observable(!1);this.SearchResults=ko.observableArray();this.RefinerGroups=ko.observableArray();this.ActiveRefiners=ko.observableArray();this.RowCount=ko.observable(0);this.TotalRows=ko.observable(0);this.QueryInput=ko.observable(WisePoint.Utils.GetQueryStringParameter("k"));this.IsPerformingReset=ko.observable(!1);this.SearchBoxFocused=ko.observable(!1);this.IsLoading=ko.observable(!0);this.IsAdminUser=ko.observable(!1);this.CurrentRequest=null;this.ActiveQuery=null;this.HasMoreResults=ko.pureComputed(function(){return t.TotalRows()>t.RowCount()});this.RefinerDefinitions=ko.pureComputed(function(){try{var n=t.Refiners().split(";");return Enumerable.From(n).Select(function(n){var t=n.split(",");return{Name:t[0],Label:t[1]}}).ToArray()}catch(i){return WisePoint.Utils.Log("Failed to parse refiners string"),[]}});this.RefinersPostString=ko.pureComputed(function(){try{var i=Enumerable.From(t.RefinerDefinitions()).Select(function(n){return n.Name}).ToArray().join(","),n=", 'Refiners': '"+i+"'";return WisePoint.Utils.Log("RefinersPostString : "+n),n}catch(r){return WisePoint.Utils.Log("Failed to generate refiners post string"),""}});this.Search=function(n,i){typeof i=="undefined"&&(i=!0);n&&(t.IsPerformingReset(!0),t.ActiveQuery=t.QueryInput(),t.SearchResults.removeAll(),t.RowCount(0),t.TotalRows(0),i&&t.RefinerGroups.removeAll());t.IsLoading(!0);var r=t.ActiveQuery===""?"*":t.ActiveQuery;t.ActiveQuery!=""&&t.AppendWildcard&&(r+="*");setTimeout(function(){var i,f,u,e;if(t.CurrentRequest!=null)try{t.CurrentRequest.abort()}catch(h){WisePoint.Utils.Log(h.message)}if(i="",f=t.ActiveRefiners(),f.length>0){for(i=", 'RefinementFilters': { 'results': [",u=0;u<f.length;u++)e=f[u],u>0&&(i+=","),i+="'"+e.GroupName+":"+e.Token+"'";i+="] }"}var c=t.ResultsPerQuery,o=n?0:t.RowCount(),l=", 'StartRow' : '"+o+"'",a=t.AppendedQuery==""?"":",'HiddenConstraints':'"+t.AppendedQuery.replace(/\'/gi,"'")+"'",v=t.SortResults?",'SortList': { 'results': [{'Property':'LastName','Direction': '0'}, {'Property':'FirstName','Direction': '0'}] }":"",s="{ 'request': { 'Querytext': '"+r.replace(/\'/gi,"'")+"'"+a+",'EnableNicknames':'True', 'TrimDuplicates':'False','GenerateBlockRankLog' : 'False', 'ProcessBestBets' : 'False', 'EnableQueryRules' : 'False', 'BypassResultTypes':'True', 'EnablePhonetic':'True', 'SelectProperties': { 'results': ['LastName', 'FirstName', 'JobTitle', 'Department', 'WorkEmail', 'PictureURL', 'AccountName', 'PreferredName', 'Path'] }"+v+t.RefinersPostString()+", 'SourceId': '"+t.ResultSourceId()+"'"+i+l+", 'RowLimit' : "+c+" } }",y=t.AppWebUrl+"/_api/search/postquery";WisePoint.Utils.Log("PostQuery ("+o+") : "+s);t.CurrentRequest=$.ajax({url:y,headers:{accept:"application/json; odata=verbose","x-requestdigest":$("#__REQUESTDIGEST").val(),"x-requestforceauthentication":!0},type:"POST",data:s,contentType:"application/json;odata=verbose",success:t.OnSuccess,error:t.OnError})},0)};this.OnSuccess=function(n){var r,i,u;if(t.IsPerformingReset()){r=n.d.postquery.PrimaryQueryResult.RefinementResults===null?[]:Enumerable.From(n.d.postquery.PrimaryQueryResult.RefinementResults.Refiners.results).Select(function(n){var i=Enumerable.From(n.Entries.results).Select(function(i){var r=Enumerable.From(t.ActiveRefiners()).Any(function(t){return t.GroupName===n.Name&&t.Value===i.RefinementValue});return new WisePoint.PeopleSearch.Models.RefinerEntry(t,n.Name,i.RefinementName,i.RefinementToken,i.RefinementCount,i.RefinementValue,r)}).ToArray();return new WisePoint.PeopleSearch.Models.RefinerGroup(t,n.Name,i)});i=[];try{i=r.ToArray()}catch(f){}try{t.RefinerGroups(i)}catch(f){WisePoint.Utils.DisplayErrorMessage("error loading refiners")}}n.d.postquery.PrimaryQueryResult.RelevantResults!=null?(t.RowCount(t.RowCount()+n.d.postquery.PrimaryQueryResult.RelevantResults.Table.Rows.results.length),t.TotalRows(n.d.postquery.PrimaryQueryResult.RelevantResults.TotalRows),t.IsPerformingReset(!1),u=Enumerable.From(n.d.postquery.PrimaryQueryResult.RelevantResults.Table.Rows.results).Select(function(n){var u=WisePoint.Utils.GetSearchResultField(n,"AccountName"),i=WisePoint.Utils.GetSearchResultField(n,"LastName"),r=WisePoint.Utils.GetSearchResultField(n,"FirstName"),f=WisePoint.Utils.GetSearchResultField(n,"JobTitle"),e=WisePoint.Utils.GetSearchResultField(n,"Path"),o=WisePoint.Utils.GetSearchResultField(n,"WorkEmail"),s=WisePoint.Utils.GetSearchResultField(n,"Department"),h=WisePoint.Utils.GetSearchResultField(n,"PreferredName"),c=i==null||r==null?h:i+" "+r.toUpperCase(),l=t.HostWebUrl+"/_layouts/15/userphoto.aspx?accountname="+encodeURIComponent(u)+(t.HighDefinitionPhotos?"&size=L":"&size=M");return new WisePoint.PeopleSearch.Models.SearchResult(i,r,c,f,e,o,s,l)}).ToArray(),t.RecDisplayResults(u,0)):(t.IsLoading(!1),t.IsPerformingReset(!1));t.CurrentRequest=null};this.RecDisplayResults=function(n,i){if(!t.IsPerformingReset()){if(n.length<=i){t.IsLoading(!1);t.ShowMoreResultsIfScrolledDown();return}var r=n[i];t.SearchResults.push(r);setTimeout(function(){t.RecDisplayResults(n,i+1)},50)}};this.OnError=function(n){if(n.statusText==="abort"){t.CurrentRequest=null;return}WisePoint.Utils.Log("AJAX ERROR : "+n.status+" "+n.statusText);WisePoint.Utils.Log(n.responseText);t.CurrentRequest=null;t.IsLoading(!1);t.IsPerformingReset(!1)};this.AfterAddContact=function(n){if(n.nodeType===1)$(n).find("img").one("load",function(){try{var n=$(this),t=typeof n[0].naturalWidth!="undefined"?n[0].naturalWidth:n[0].width,i=typeof n[0].naturalHeight!="undefined"?n[0].naturalHeight:n[0].height;if(t===i&&t===150){n.attr("style","margin-left:0");return}n.attr("style",t>i?"height:150px;margin-left:"+Math.floor(-((150*t/i-150)/2))+"px":"margin-left:0;width:150px;margin-top:"+Math.floor(-((150*i/t-150)/2))+"px")}catch(r){WisePoint.Utils.Log(r.toString())}})};this.BeforeRemoveContact=function(n){n.nodeType===1&&$(n).stop().hide().remove()};this.SearchBoxClass=ko.pureComputed(function(){return t.SearchBoxFocused()?"ms-srch-sbLarge ms-srch-sb-borderFocused":"ms-srch-sbLarge ms-srch-sb-border"},t);this.SearchBoxKeyPress=function(n,t){return t.keyCode===13?(n.ResetSearch(),!1):!0};this.IsLoadingFirstResults=ko.pureComputed(function(){return t.IsLoading()&&t.RowCount()===0&&t.IsPerformingReset()});this.IsNotLoadingFirstResults=ko.pureComputed(function(){return!t.IsLoadingFirstResults()});this.IsLoadingMoreResults=ko.pureComputed(function(){return t.IsLoading()&&!t.IsPerformingReset()});this.HasResults=ko.pureComputed(function(){return t.TotalRows()>0});this.NoResult=ko.pureComputed(function(){return!t.IsLoading()&&t.TotalRows()===0});this.NoRefinerAvailable=ko.pureComputed(function(){return!t.IsLoading()&&t.RefinerGroups().length===0});this.ShowMoreResults=function(){t.Search(!1)};this.ResetSearch=function(){t.RefinerGroups.removeAll();t.ActiveRefiners.removeAll();t.Search(!0)};this.ScrollableArea.scroll(function(){t.ShowMoreResultsIfScrolledDown()});this.ShowMoreResultsIfScrolledDown=function(){!t.IsLoading()&&t.HasMoreResults()&&t.ScrollableArea.outerHeight()+320>=t.ScrollableArea.get(0).scrollHeight-t.ScrollableArea.scrollTop()&&t.ShowMoreResults()};this.ResultsHeaderText=ko.computed(function(){switch(t.TotalRows()){case 0:return WisePoint.PeopleSearch.Resources.Current.NoResult;case 1:return WisePoint.PeopleSearch.Resources.Current.ResultsCount1;default:return WisePoint.PeopleSearch.Resources.Current.ResultsCount.replace(/\{0\}/gi,t.TotalRows())}});this.Initialize=function(){ExecuteOrDelayUntilScriptLoaded(function(){var n=new SP.ClientContext.get_current,r=n.get_web(),u=r.get_allProperties(),i,f;n.load(u);i=new SP.BasePermissions;i.set(SP.PermissionKind.manageWeb);f=r.doesUserHavePermissions(i);n.executeQueryAsync(Function.createDelegate(this,function(){var n=u.get_fieldValues();typeof n.MainPageTitle!="undefined"?t.PageTitle(n.MainPageTitle):t.PageTitle(WisePoint.PeopleSearch.Resources.Current.DefaultMainPageTitle);typeof n.SortResults!="undefined"&&(t.SortResults=n.SortResults==="1");typeof n.HighDefinitionPhotos!="undefined"&&(t.HighDefinitionPhotos=n.HighDefinitionPhotos==="1");typeof n.ResultsPerQuery!="undefined"&&(t.ResultsPerQuery=n.ResultsPerQuery);typeof n.AppendWildcard!="undefined"&&(t.AppendWildcard=n.AppendWildcard==="1");typeof n.AppendedQuery!="undefined"&&(t.AppendedQuery=n.AppendedQuery);typeof n.Refiners!="undefined"&&t.Refiners(n.Refiners);typeof n.ResultSourceId!="undefined"&&t.ResultSourceId(n.ResultSourceId);t.IsAdminUser(f.get_value());t.Initialized(!0);t.ResetSearch()}),Function.createDelegate(this,function(n,i){t.Initialized(!0);WisePoint.Utils.log("ERROR : Failed to load web properties : "+i);t.ResetSearch()}))},"sp.js")};this.Initialize()};window.WisePoint=window.WisePoint||{};WisePoint.Utils=WisePoint.Utils||{};WisePoint.PeopleSearch=WisePoint.PeopleSearch||{};WisePoint.PeopleSearch.Resources=WisePoint.PeopleSearch.Resources||{};WisePoint.PeopleSearch.Models=WisePoint.PeopleSearch.Models||{};WisePoint.PeopleSearch.ViewModels=WisePoint.PeopleSearch.ViewModels||{};WisePoint.PeopleSearch.ViewModels.SettingsPage=function(){var n=this;this.AppTitle=ko.observable("WisePoint People Search");this.IsAppTitleInvalid=ko.observable(!1);this.MainPageTitle=ko.observable(WisePoint.PeopleSearch.Resources.Current.DefaultMainPageTitle);this.SortResults=ko.observable(!1);this.HighDefinitionPhotos=ko.observable(!0);this.ResultsPerQuery=ko.observable(50);this.AppendWildcard=ko.observable(!1);this.ResultSourceId=ko.observable("B09A7990-05EA-4AF9-81EF-EDFAB16C4E31");this.AppendedQuery=ko.observable("-AccountName:_spo* -AccountName:app@sharepoint -AccountName:#ext#");this.Refiners=ko.observable(WisePoint.PeopleSearch.Resources.Current.SettingsSectionSearchQueryRefinersDefaultValue);this.Updating=ko.observable(!1);this.Loaded=ko.observable(!1);this.ResultsPerQueryInt=ko.pureComputed(function(){try{return parseInt(n.ResultsPerQuery())}catch(t){return-1}},this);this.IsResultsPerQueryValid=ko.pureComputed(function(){try{var t=n.ResultsPerQueryInt();return t>=5&&t<=100}catch(i){return!1}},this);this.IsResultsPerQueryInvalid=ko.pureComputed(function(){return!n.IsResultsPerQueryValid()},this);this.IsValid=ko.pureComputed(function(){return n.IsResultsPerQueryValid()},this);this.Load=function(){var t=SP.ClientContext.get_current(),i=t.get_web(),r;t.load(i);r=i.get_allProperties();t.load(r);t.executeQueryAsync(Function.createDelegate(this,function(){n.AppTitle(i.get_title());var t=r.get_fieldValues();typeof t.MainPageTitle!="undefined"&&n.MainPageTitle(t.MainPageTitle);typeof t.SortResults!="undefined"&&n.SortResults(t.SortResults==="1");typeof t.HighDefinitionPhotos!="undefined"&&n.HighDefinitionPhotos(t.HighDefinitionPhotos==="1");typeof t.ResultsPerQuery!="undefined"&&n.ResultsPerQuery(t.ResultsPerQuery);typeof t.AppendWildcard!="undefined"&&n.AppendWildcard(t.AppendWildcard==="1");typeof t.AppendedQuery!="undefined"&&n.AppendedQuery(t.AppendedQuery);typeof t.Refiners!="undefined"&&n.Refiners(t.Refiners);typeof t.ResultSourceId!="undefined"&&n.ResultSourceId(t.ResultSourceId);n.Loaded(!0)}),Function.createDelegate(this,function(n,t){WisePoint.Utils.log("ERROR : Failed to load properties. "+t);WisePoint.Utils.DisplayErrorMessage(WisePoint.PeopleSearch.Resources.Current.ErrorLoadingProperties)}))};this.Update=function(){if(n.IsValid()){n.Updating(!0);var r=new SP.ClientContext.get_current,i=r.get_web(),t=i.get_allProperties();i.set_title(n.AppTitle());t.set_item("MainPageTitle",n.MainPageTitle());t.set_item("SortResults",n.SortResults()?"1":"0");t.set_item("HighDefinitionPhotos",n.HighDefinitionPhotos()?"1":"0");t.set_item("ResultsPerQuery",n.ResultsPerQueryInt());t.set_item("AppendWildcard",n.AppendWildcard()?"1":"0");t.set_item("AppendedQuery",n.AppendedQuery());t.set_item("ResultSourceId",n.ResultSourceId());t.set_item("Refiners",n.Refiners());i.update();r.executeQueryAsync(Function.createDelegate(this,function(){window.location="Default.aspx"+WisePoint.Utils.GetQueryString()}),Function.createDelegate(this,function(){n.Updating(!1);WisePoint.Utils.DisplayErrorMessage(WisePoint.PeopleSearch.Resources.Current.ErrorUpdatingProperties)}))}};this.Cancel=function(){window.location="Default.aspx"+WisePoint.Utils.GetQueryString()};this.Load()};
//# sourceMappingURL=WisePoint.PeopleSearch.1.0.3.2.min.js.map
